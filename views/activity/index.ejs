<% layout('layouts/app') %>

<div class="container-modern" style="padding: 2rem 0;">
    <div style="display:flex; justify-content:space-between; align-items:center; gap:1rem; margin-bottom:1.25rem;">
        <h1 style="color:var(--primary-red); font-size:1.75rem;">Manage Activities</h1>
        <a href="/activity/new" class="btn-modern primary"><i class="fas fa-plus"></i> Add New Activity</a>
    </div>

    <% if (activities.length === 0) { %>
        <div class="card" style="text-align:center; padding:2rem;">
            <i class="fas fa-inbox" style="font-size:3rem; color:var(--text-light); margin-bottom:1rem;"></i>
            <p style="font-size:1.1rem; color:var(--text-light);">No activities yet. Create your first one!</p>
            <a href="/activity/new" class="btn-modern primary" style="margin-top:1rem; display:inline-block;">Add Activity</a>
        </div>
    <% } else { %>
        <div style="display:grid; gap:1rem;">
            <% activities.forEach(activity => { %>
                <div class="card" style="display:grid; grid-template-columns: 180px 1fr 140px; gap:1rem; align-items:start; <%= activity.isActive ? '' : 'opacity:0.6;' %>">
                    <div style="height:120px; overflow:hidden; border-radius:8px;">
                        <% if (activity.image && activity.image.path) { %>
                            <img src="<%= activity.image.path %>" alt="<%= activity.title %>" style="width:100%; height:100%; object-fit:cover;">
                        <% } else { %>
                            <div style="width:100%; height:100%; background:linear-gradient(135deg,var(--primary-red),#ff6b6b); display:flex; align-items:center; justify-content:center; color:#fff; font-size:2rem;">
                                <i class="fas <%= activity.placeholderIcon %>"></i>
                            </div>
                        <% } %>
                    </div>
                    <div>
                        <div style="display:flex; gap:.5rem; align-items:center; margin-bottom:.5rem;">
                            <span style="background:var(--primary-red); color:#fff; padding:.35rem .6rem; border-radius:999px; font-weight:700; font-size:.85rem;"><%= activity.category %></span>
                            <% if (!activity.isActive) { %>
                                <span style="background:#999; color:#fff; padding:.25rem .5rem; border-radius:999px; font-size:.8rem;">Inactive</span>
                            <% } %>
                        </div>
                        <h3 style="margin:0 0 .5rem; font-size:1.15rem;"><%= activity.title %></h3>
                        <p style="color:var(--primary-red); font-style:italic; margin:0 0 .5rem;">"<%= activity.tagline %>"</p>
                        <p style="color:var(--text-light); display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical; overflow:hidden;"><%= activity.description %></p>
                        <div style="margin-top:.75rem; color:var(--text-light); font-size:.9rem; display:flex; gap:1rem;">
                            <span><i class="fas <%= activity.departmentIcon %>"></i> <%= activity.department %></span>
                            <span>Order: <%= activity.order %></span>
                        </div>
                    </div>
                    <div style="display:flex; flex-direction:column; gap:.5rem;">
                        <a href="/activity/<%= activity._id %>" class="btn-modern secondary">View</a>
                        <a href="/activity/<%= activity._id %>/edit" class="btn-modern edit">Edit</a>
                        <form action="/activity/<%= activity._id %>/toggle" method="POST" style="margin:0;">
                            <button type="submit" class="btn-modern" style="background:<%= activity.isActive ? '#ffc107' : '#17a2b8' %>; color:#fff;"> <i class="fas fa-<%= activity.isActive ? 'eye-slash' : 'eye' %>"></i> <%= activity.isActive ? 'Hide' : 'Show' %></button>
                        </form>
                        <form action="/activity/<%= activity._id %>" method="POST" onsubmit="return confirm('Are you sure you want to delete this activity?');">
                            <input type="hidden" name="_method" value="DELETE">
                            <button type="submit" class="btn-modern delete">Delete</button>
                        </form>
                    </div>
                </div>
            <% }) %>
        </div>
    <% } %>
</div>
